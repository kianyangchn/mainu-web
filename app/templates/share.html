<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Shared menu • mainu Web</title>
    <style>
      :root {
        color-scheme: light;
        font-family: "Inter", "Nunito", system-ui, -apple-system, BlinkMacSystemFont,
          "Segoe UI", sans-serif;
        --bg-gradient: linear-gradient(180deg, #f2f6ff 0%, #fff1e8 55%, #fef6ff 100%);
        --bg-card: rgba(255, 255, 255, 0.95);
        --glass: rgba(255, 255, 255, 0.82);
        --primary: #2f7bff;
        --primary-dark: #1d5bdb;
        --accent: #ff8360;
        --text-strong: #1f2937;
        --text-muted: #5f6a84;
        --shadow-card: 0 18px 44px rgba(31, 54, 110, 0.14);
        --radius-card: 18px;
        --radius-pill: 999px;
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        min-height: 100vh;
        background: var(--bg-gradient);
        color: var(--text-strong);
        padding: 32px 20px 80px;
      }

      main {
        max-width: 660px;
        margin: 0 auto;
        display: flex;
        flex-direction: column;
        gap: 24px;
      }

      .hero {
        display: flex;
        flex-direction: column;
        gap: 16px;
        padding: 26px 24px;
        border-radius: var(--radius-card);
        background: var(--bg-card);
        box-shadow: var(--shadow-card);
        text-align: center;
      }

      .hero-pill {
        display: inline-flex;
        justify-content: center;
        align-self: center;
        padding: 8px 16px;
        border-radius: var(--radius-pill);
        background: rgba(47, 123, 255, 0.12);
        color: var(--primary);
        font-weight: 600;
        font-size: 0.88rem;
      }

      h1 {
        margin: 0;
        font-size: clamp(1.8rem, 4.4vw, 2.4rem);
        font-weight: 600;
        letter-spacing: -0.015em;
      }

      .hero-metadata {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 10px;
      }

      .pill {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 8px 14px;
        border-radius: var(--radius-pill);
        background: rgba(47, 123, 255, 0.1);
        color: var(--primary-dark);
        font-weight: 600;
        font-size: 0.86rem;
      }

      .pill[data-variant="countdown"] {
        background: rgba(255, 131, 96, 0.14);
        color: var(--accent);
      }

      .hero-actions {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
        gap: 12px;
        margin-top: 8px;
      }

      button {
        appearance: none;
        border-radius: 14px;
        border: 1px solid rgba(31, 54, 110, 0.12);
        background: rgba(247, 249, 255, 0.9);
        padding: 14px 18px;
        font-size: 1rem;
        font-weight: 600;
        color: var(--text-strong);
        display: inline-flex;
        justify-content: center;
        align-items: center;
        gap: 6px;
        cursor: pointer;
        transition: transform 0.18s ease, box-shadow 0.18s ease;
      }

      button.primary {
        background: linear-gradient(135deg, var(--primary), #1d5bdb);
        color: white;
        border-color: transparent;
        box-shadow: 0 16px 34px rgba(47, 123, 255, 0.26);
      }

      button.primary:hover,
      button.secondary:hover,
      button.primary:focus-visible,
      button.secondary:focus-visible {
        transform: translateY(-1px);
      }

      button.secondary {
        background: rgba(47, 123, 255, 0.08);
        color: var(--primary-dark);
        border-color: rgba(47, 123, 255, 0.18);
      }

      button:disabled {
        opacity: 0.55;
        cursor: not-allowed;
        transform: none;
        box-shadow: none;
      }

      .menu-card {
        background: var(--bg-card);
        border-radius: var(--radius-card);
        box-shadow: var(--shadow-card);
        display: flex;
        flex-direction: column;
        gap: 20px;
        padding: 24px 24px 28px;
      }

      .section-list {
        display: flex;
        flex-direction: column;
        gap: 18px;
      }

      details.section {
        border-radius: 16px;
        background: rgba(247, 249, 255, 0.82);
        border: 1px solid rgba(31, 54, 110, 0.12);
        padding: 18px 20px;
      }

      summary.section-header {
        list-style: none;
        display: flex;
        justify-content: space-between;
        align-items: center;
        cursor: pointer;
        font-weight: 600;
        font-size: 1.1rem;
      }

      summary.section-header::-webkit-details-marker {
        display: none;
      }

      .badge {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        padding: 4px 10px;
        border-radius: var(--radius-pill);
        background: rgba(47, 123, 255, 0.12);
        color: var(--primary-dark);
        font-size: 0.8rem;
        font-weight: 600;
      }

      .dish-list {
        list-style: none;
        margin: 18px 0 0;
        padding: 0;
        display: flex;
        flex-direction: column;
        gap: 16px;
      }

      .dish-card {
        border-radius: 16px;
        padding: 18px 18px 20px;
        background: linear-gradient(135deg, rgba(255, 255, 255, 0.98), rgba(232, 246, 255, 0.8));
        border: 1px solid rgba(47, 123, 255, 0.14);
        box-shadow: 0 16px 28px rgba(47, 123, 255, 0.1);
        display: flex;
        flex-direction: column;
        gap: 12px;
      }

      .dish-headline {
        display: flex;
        justify-content: space-between;
        gap: 12px;
      }

      .dish-name {
        display: flex;
        flex-direction: column;
        gap: 6px;
      }

      .translated-name {
        font-weight: 600;
        font-size: 1.05rem;
      }

      .original-name {
        display: inline-flex;
        align-self: flex-start;
        padding: 4px 10px;
        border-radius: var(--radius-pill);
        background: rgba(47, 123, 255, 0.12);
        color: var(--primary-dark);
        font-size: 0.82rem;
        font-weight: 600;
      }

      .price {
        font-weight: 600;
        color: var(--primary-dark);
      }

      .dish-description {
        margin: 0;
        color: var(--text-muted);
        line-height: 1.5;
      }

      .footer-card {
        background: var(--glass);
        border-radius: var(--radius-card);
        padding: 22px 24px;
        text-align: center;
        border: 1px solid rgba(31, 54, 110, 0.08);
      }

      .footer-card p {
        margin: 4px 0 0;
        color: var(--text-muted);
      }

      .expired-card {
        max-width: 520px;
        margin: 60px auto;
        background: var(--bg-card);
        border-radius: var(--radius-card);
        padding: 28px 26px;
        text-align: center;
        box-shadow: var(--shadow-card);
        display: flex;
        flex-direction: column;
        gap: 18px;
      }

      .expired-card h1 {
        font-size: 1.9rem;
      }

      .expired-card p {
        margin: 0;
        color: var(--text-muted);
      }

      @media (prefers-reduced-motion: reduce) {
        button,
        .dish-card,
        .hero,
        .menu-card {
          transition: none;
        }
      }
    </style>
  </head>
  <body>
    {% if is_expired %}
      <section class="expired-card" role="status">
        <span class="hero-pill">Trip link expired</span>
        <h1>This menu link has ended its trip.</h1>
        <p>Ask your host to resend the share code or start a fresh menu capture to keep planning.</p>
        <button class="primary" type="button" onclick="window.location.href='/'">Start a new menu</button>
        <p style="font-size: 0.85rem;">Reference: {{ token }}</p>
      </section>
    {% else %}
      <main>
        <header class="hero">
          <span class="hero-pill">Shared via mainu</span>
          <h1>Browse the dishes together</h1>
          <div class="hero-metadata">
            <span class="pill">Share code · {{ token }}</span>
            {% if menu.original_language %}
              <span class="pill">Original language · {{ menu.original_language }}</span>
            {% endif %}
            <span class="pill" data-variant="countdown" id="countdown-pill" data-expires="{{ expires_at.isoformat() }}" data-remaining="{{ expires_in_seconds }}">
              Expires soon
            </span>
          </div>
          <p style="margin: 0; color: var(--text-muted);">Shared by your travel buddy – pick your favourites and compare before you arrive.</p>
          <div class="hero-actions">
            <button type="button" class="primary" id="copy-link">Copy link</button>
            <button type="button" class="secondary" id="open-in-app">Open in new tab</button>
            <button type="button" class="secondary" disabled>Language options (soon)</button>
          </div>
        </header>

        <article class="menu-card">
          <div>
            <h2 style="margin: 0 0 12px;">Menu overview</h2>
            <p style="margin: 0; color: var(--text-muted);">Tap each section to reveal the dishes translation crafted by mainu.</p>
          </div>
          <div class="section-list">
            {% for section in menu.sections %}
              <details class="section" {% if loop.first %}open{% endif %}>
                <summary class="section-header">
                  <span>{{ section.title }}</span>
                  <span class="badge">{{ section.dishes | length }} dishes</span>
                </summary>
                <ul class="dish-list">
                  {% for dish in section.dishes %}
                    <li class="dish-card">
                      <div class="dish-headline">
                        <div class="dish-name">
                          <span class="translated-name">{{ dish.translated_name }}</span>
                          <span class="original-name">{{ dish.original_name }}</span>
                        </div>
                        {% if dish.price %}
                          <span class="price">{{ dish.price }}</span>
                        {% endif %}
                      </div>
                      <p class="dish-description">{{ dish.description }}</p>
                    </li>
                  {% endfor %}
                </ul>
              </details>
            {% endfor %}
          </div>
        </article>

        <section class="footer-card">
          <strong>Bon appétit!</strong>
          <p>Need a fresh translation? Capture and share new menus anytime from the mainu home screen.</p>
        </section>
      </main>

      <script>
        const countdownPill = document.getElementById("countdown-pill");
        const copyButton = document.getElementById("copy-link");
        const openButton = document.getElementById("open-in-app");
        const shareUrl = window.location.href;

        function updateCountdown() {
          if (!countdownPill) return;
          const expires = new Date(countdownPill.dataset.expires || "");
          if (Number.isNaN(expires.getTime())) {
            countdownPill.textContent = "Link active";
            return;
          }
          const remaining = Math.max(0, Math.floor((expires - new Date()) / 1000));
          if (remaining <= 0) {
            countdownPill.textContent = "Link expired";
            return;
          }
          const hours = Math.floor(remaining / 3600);
          const minutes = Math.floor((remaining % 3600) / 60);
          countdownPill.textContent = `Expires in ${hours}h ${minutes}m`;
        }

        updateCountdown();
        if (parseInt(countdownPill?.dataset.remaining || "0", 10) > 0) {
          setInterval(updateCountdown, 60000);
        }

        copyButton?.addEventListener("click", async () => {
          try {
            await navigator.clipboard.writeText(shareUrl);
            copyButton.textContent = "Link copied";
            setTimeout(() => {
              copyButton.textContent = "Copy link";
            }, 2000);
          } catch (error) {
            console.error(error);
          }
        });

        openButton?.addEventListener("click", () => {
          window.open(shareUrl, "_blank", "noopener");
        });
      </script>
    {% endif %}
  </body>
</html>
